From a71befd22dd3574b0f50da9cfe1e46b71b235410 Mon Sep 17 00:00:00 2001
From: David Siegel <david.siegel@artcom.de>
Date: Sun, 12 Feb 2012 13:42:56 +0100
Subject: [PATCH] gyp_addon: added process.buildDir (minimalistic not
 beautiful)

---
 node.gyp       |    1 +
 src/node.cc    |    3 +++
 tools/gyp_node |    1 +
 3 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/node.gyp b/node.gyp
index e08f447..ee6ace3 100644
--- a/node.gyp
+++ b/node.gyp
@@ -124,6 +124,7 @@
         'NODE_WANT_INTERNALS=1',
         'ARCH="<(target_arch)"',
         'PLATFORM="<(OS)"',
+        'NODE_BUILD_DIR="<(node_root)"',
       ],
 
       'conditions': [
diff --git a/src/node.cc b/src/node.cc
index a9590f6..cfa0bbc 100644
--- a/src/node.cc
+++ b/src/node.cc
@@ -2056,6 +2056,9 @@ Handle<Object> SetupProcessObject(int argc, char *argv[]) {
   // process.arch
   process->Set(String::NewSymbol("arch"), String::New(ARCH));
 
+  // process.buildDir
+  process->Set(String::NewSymbol("buildDir"), String::New(NODE_BUILD_DIR));
+
   // process.platform
   process->Set(String::NewSymbol("platform"), String::New(PLATFORM));
 
diff --git a/tools/gyp_node b/tools/gyp_node
index 5ecdf8f..7f88cb4 100755
--- a/tools/gyp_node
+++ b/tools/gyp_node
@@ -55,5 +55,6 @@ if __name__ == '__main__':
   args.append('-Dtarget_arch=ia32')
   args.append('-Dcomponent=static_library')
   args.append('-Dlibrary=static_library')
+  args.append('-Dnode_root=' + os.path.abspath(node_root))
   gyp_args = list(args)
   run_gyp(gyp_args)
-- 
1.7.7.4

